"0","#| warning: false"
"0","list_of_data_to_clean$messy_aki.xlsx %>% "
"0","  # Extract only the essential rows"
"0","  slice(5:25) %>% "
"0","  # Remove empty columns"
"0","  select(-6) %>% "
"0","  # Set the first row as column names"
"0","  set_names(.,.[1,]) %>% "
"0","  # Remove redudant first row"
"0","  slice(-1) %>% "
"0","  # Tidy column names"
"0","  rename_with(~tolower(str_replace(.x, ""^(?i)day.*?(\\d).*"",""day\\1_gfr""))) %>% "
"0","  rename_with(~str_replace_all(.x,""\\s+"",""_"")) %>% "
"0","  # Tidy the entries of birthdate column"
"0","  arrange(desc(dob)) %>% # Arrange to detect patterns of anomalies"
"0","  # Convert 5-digit general numbers to ISO dates"
"0","  mutate(dob_temp = openxlsx::convertToDate(dob), .after = dob) %>% "
"0","  # Edit special cases"
"0","  mutate(dob_temp = case_match(dob, ""may 5 1970"" ~ ymd(""1970-05-05""), ""5=11-1984""~ ymd(""1984-05-11""), .default = dob_temp))  %>% "
"0","  # Rename ""dob"" to ""birthdate"" and remove ""dob"", ""dob_temp"""
"0","  mutate(birthdate = dob_temp, .after = study_id) %>% "
"0","  select(-dob_temp,-dob) %>% "
"0","  mutate(race = str_to_sentence(race)) %>% "
"0","  mutate(sex = if_else(str_detect(sex,""^(?i)M""), ""Male"",""Female"")) %>% "
"0","  mutate(hispanic = if_else(str_detect(hispanic, ""^(?i)N""), ""Not Hispanic"", ""Hispanic"")) %>% "
"0","  mutate(day2_gfr_poor = if_else(str_detect(day2_gfr,""poor""),1,0)) %>% "
"0","  mutate(across(c(study_id,admission_gfr:day5_gfr), ~as.integer(str_extract(.x,""^\\d+"")))) %>% "
"0","  # count(sediment) %>%"
"0","  # pull(sediment) %>%"
"0","  # cbind %>% "
"0","  # map2(.y = c("
"0","  #   ""\"" ~ \""many epithelial cell"","
"0","  #   ""\"" ~ \""many epithelial cell"","
"0","  #   ""\"" ~ \""many granular"","
"0","  #   ""\"" ~ \""muddy brown"","
"0","  #   ""\"" ~ \""muddy brown"","
"0","  #   ""\"" ~ \""rare granular"","
"0","  #   ""\"" ~ \""rare granular""), .f = ~paste0(.x,.y)) %>%"
"0","  # unlist %>%"
"0","  # paste0(""\"""",.,""\"""", collapse = "",\n "") %>%"
"0","  # writeLines(con = ""clipboard"")"
"0","mutate(sediment = case_match("
"0","  sediment,"
"0","""many epi cell casts"" ~ ""many epithelial cell"","
"0"," ""many epithelial cell casts"" ~ ""many epithelial cell"","
"0"," ""many granular casts"" ~ ""many granular"","
"0"," ""muddy brown"" ~ ""muddy brown"","
"0"," ""muddy brown casts"" ~ ""muddy brown"","
"0"," ""rare gran casts"" ~ ""rare granular"","
"0"," ""rare granular casts"" ~ ""rare granular"","
"0",".default = sediment"
"0",")) %>% "
"0","  mutate(across(hd_catheter:av_fistula, "
"0","                ~if_else(str_detect(.x,""^(?i)N""),""No"",""Yes""))) %>% "
"0","  arrange(study_id)"
